import { WaypointCommand } from './WaypointCommand';

// The takeoff command represents a location on the map where the drone will takeoff from and/or land as part of a mission.
// Most autopilot will overwrite this with the actual takeoff location but we will use this for estimated flight time
// calculations.
export class TakeoffCommand extends WaypointCommand {

    constructor(type: string, id: string, handle: any, public isBase: boolean) {
        super(type, id, handle, true);

        if (this.handle) {
            this.hydrate(this.handle.data);

            if (!isBase) {
                this.handle.on(this.handle.EVENTS.DATA_CHANGED, this.hydrate.bind(this));
            }
        }
    }

    // Vertical speed in meters per second
    ClimbSpeed: number;

    // Rate of climb or descent in m/s
    Rate: number;

    hydrate(data: any): boolean {

        if (_.isEmpty(data)) {
            this.handle.off(this.handle.EVENTS.DATA_CHANGED);
            return;
        }

        if (data) {

            var dataChanged: boolean = false;

            dataChanged = super.hydrate(data);

            if (this.ClimbSpeed !== data.ClimbSpeed) {
                this.ClimbSpeed = data.ClimbSpeed;
                dataChanged = true;
            }

            if (dataChanged && !this.isBase) {
                //this.onModelUpdated.trigger('dataChanged');
            }

            return dataChanged;
        }
    }

}
