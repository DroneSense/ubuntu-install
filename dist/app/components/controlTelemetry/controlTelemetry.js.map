{"version":3,"sources":["components/controlTelemetry/controlTelemetry.ts"],"names":[],"mappings":"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","file":"components/controlTelemetry/controlTelemetry.js","sourcesContent":["import { } from '@dronesense/model';\n\nimport IDrone from '@dronesense/core/lib/common/IDrone';\n\nimport { SessionController } from '../flightControlViewer/sessionController';\nimport { OwnerMapSession, MapSession } from '../flightControlViewer/mapSession';\n\nimport { IGuidedWaypoint } from '@dronesense/core/lib/common/entities/IGuidedWaypoint';\n\nimport { MapWaypoint } from '../flightControlViewer/mapSession';\n\nexport interface IControlTelemetry extends ng.IScope {\n\n}\n\nclass ControlTelemetry {\n\n    sessionController: SessionController;\n\n    drone: IDrone;\n\n    isDJIDrone: boolean = true;\n\n    horizontalSpeedValue: string = '-180deg';\n\n    verticalSpeedValue: string = '-180deg';\n\n    get verticalSpeedColor(): string {\n        if (this.vSpeed > 0) {\n            return '#2f87c3';\n        } else {\n            return '#00c121';\n        }\n    }\n\n    hSpeed: number = 0;\n\n    vSpeed: number = 0;\n\n    agl: number = 0;\n\n    cssAGL: string = '0px';\n\n    rollCSS: string = '0deg';\n\n    pitch: number = 0;\n\n    pitchCSS: string = '0px';\n\n    headingCSS: string = '0';\n\n    brown: string = '#6c5735';\n\n    heading: number = 0;\n\n    waypoints: Array<MapWaypoint> = [];\n\n    get aglColor(): string {\n        if (this.agl >= 120) {\n            return 'red';\n        } else {\n            return '#2f87c3';\n        }\n    }\n\n    // speed range 0-25 m/s\n\n    // Constructor\n    static $inject: Array<string> = [\n        '$scope'\n    ];\n    constructor(public bindings: IControlTelemetry) {\n\n        this.sessionController.eventing.on('session-added', (ownerSession: OwnerMapSession) => {\n            this.drone = ownerSession.mapDrone.drone;\n\n            this.bindings.$applyAsync();\n\n            this.setupWaypoints();\n\n            this.wireUpChanges();\n\n        });\n\n        this.sessionController.eventing.on('session-removed', (session: MapSession) => {\n            \n            this.unwireChanges();\n\n            this.removeWaypoint();\n            \n            this.drone = null;\n\n            this.bindings.$applyAsync();\n        });\n\n        this.sessionController.eventing.on('session-changed', (session: MapSession) => {\n            \n            if (this.drone) {\n                this.drone.FlightController.Guided.off('waypoints-changed');\n            }\n            \n            this.drone = session.mapDrone.drone;\n\n            this.setupWaypoints();\n\n            this.wireUpChanges();\n\n            this.bindings.$applyAsync();\n        });\n    }\n\n    unwireChanges(): void {\n        if (this.drone) {\n            this.drone.FlightController.Telemetry.off('propertyChanged');\n        }\n        this.hSpeed = 0;\n        this.vSpeed = 0;\n        this.agl = 0;\n        this.cssAGL = '0px';\n        this.rollCSS = '0deg';\n        this.pitch = 0;\n        this.pitchCSS = '0px';\n        this.headingCSS = '0';\n        this.brown = '#6c5735';\n        this.heading = 0;\n        this.horizontalSpeedValue = '-180deg';\n        this.verticalSpeedValue = '-180deg';\n    }\n\n    wireUpChanges(): void {\n\n        this.drone.FlightController.Telemetry.on('propertyChanged', (name, value) => {\n        \n            if (name === 'Position') {\n                this.hSpeed = +(this.drone.FlightController.Telemetry.Position.groundSpeed).toFixed(1);\n                this.horizontalSpeedValue = (-180 + ((this.hSpeed / 25) * 180)).toString() + 'deg';\n\n                this.vSpeed = +(this.drone.FlightController.Telemetry.Position.zVelocity).toFixed(1);\n                this.verticalSpeedValue = (-180 + ((Math.abs(this.vSpeed) / 10) * 180)).toString() + 'deg';\n\n                this.agl = +(this.drone.FlightController.Telemetry.Position.altitudeAGL).toFixed(1);\n                this.cssAGL = ((this.agl / 150) * 100).toString() + 'px';\n\n            }\n\n            if (name === 'Attitude') {\n\n                this.rollCSS = (this.toDegrees(this.drone.FlightController.Telemetry.Attitude.roll) * -1).toString() + 'deg';\n\n                this.pitchCSS = (this.toDegrees(this.drone.FlightController.Telemetry.Attitude.pitch) * 2).toString() + 'px';\n\n                this.headingCSS = (this.drone.FlightController.Telemetry.Position.heading).toString();\n\n                this.heading = Math.round(this.drone.FlightController.Telemetry.Position.heading);\n            }\n            \n            this.bindings.$applyAsync();\n\n        });\n    }\n\n    setupWaypoints(): void {\n        this.waypoints = this.sessionController.activeSession.mapWaypoints.waypoints;\n\n        this.drone.FlightController.Guided.on('waypoints-changed', () => {\n            this.bindings.$applyAsync();\n        });\n    }\n\n    removeWaypoint(): void {\n        this.waypoints = null;\n\n        if (this.drone) {\n            this.drone.FlightController.Guided.off('waypoints-changed');\n        }\n    }\n    \n    waypointFilter(wp: MapWaypoint): boolean {\n        if (wp.reached) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n\n    roundToTwo(num: number): number {\n        return +num.toFixed(2);\n    }\n\n    toDegrees(radians: number): number {\n        return radians * 180 / Math.PI;\n    }\n}\n\nexport default angular.module('DroneSense.Web.ControlTelemetry', [\n\n]).component('dsControlTelemetry', {\n    bindings: {\n        sessionController: '<'\n    },\n    controller: ControlTelemetry,\n    templateUrl: './app/components/controlTelemetry/controlTelemetry.html'\n});\n"],"sourceRoot":"/source/"}