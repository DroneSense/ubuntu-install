{"version":3,"sources":["components/flightControlViewer/mapSession.ts"],"names":[],"mappings":"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","file":"components/flightControlViewer/mapSession.js","sourcesContent":["import ISession from '@dronesense/core/lib/common/ISession';\nimport IDrone from '@dronesense/core/lib/common/IDrone';\nimport ServerConnection from './serverConnection';\nimport { MapDrone } from './mapDrone';\n\nimport { IEventEmitter } from '@dronesense/core/lib/common/IEventEmitter';\nimport { FlightControlViewerEventing } from './FlightControlViewer';\n\nimport BackboneEvents from 'backbone-events-standalone';\n\nimport { MapMode } from './mapMode';\nimport { Conversions } from '@dronesense/model/lib/common/Utility';\n\nexport interface IMapSessionEvents extends IEventEmitter {\n    on(eventName: string, callback?: Function, context?: any): any;\n    on(eventName: 'locating-drone', callback?: (username: string) => void, context?: any): any;\n}\n\nimport { IGuidedWaypoint } from '@dronesense/core/lib/common/entities/IGuidedWaypoint';\n\nexport class MapWaypoint {\n\n    longitude: number;\n    latitude: number;\n    altitudeAGL: number;\n    speed: number;\n    name: string = 'A';\n    time: number;\n    distance: number;\n    index: number;\n    hae: number;\n    reached: boolean = false;\n    isActive: boolean = false;\n\n    guidedWaypoint: IGuidedWaypoint;\n\n    entity: Cesium.Entity;\n\n    constructor(guidedWaypoint: IGuidedWaypoint, index: number, hae: number) {\n        this.guidedWaypoint = guidedWaypoint;\n\n        this.longitude = this.guidedWaypoint.longitude;\n        this.latitude = this.guidedWaypoint.lattitude;\n        this.altitudeAGL = this.guidedWaypoint.altitude;\n        this.speed = this.guidedWaypoint.speed;\n        this.name = this.guidedWaypoint.name;\n        this.reached = this.guidedWaypoint.isReached;\n        this.index = index;\n        this.hae = hae;\n\n    }\n\n}\n\nexport class MapWaypoints {\n\n    waypoints: Array<MapWaypoint> = [];\n\n    currentWaypoint: MapWaypoint;\n\n    currentIndex: number;\n\n    drone: MapDrone;\n\n    map: Cesium.Viewer;\n\n    color: string;\n\n    sessionId: string;\n\n    // Container for all map UI related to this session\n    mapEntityCollection: Cesium.CustomDataSource;\n\n    constructor(drone: MapDrone, map: Cesium.Viewer, color: string, sesisonId: string, entityCollection: Cesium.CustomDataSource, public eventing: FlightControlViewerEventing) {\n        this.drone = drone;\n        this.map = map;\n        this.color = color;\n        this.sessionId = sesisonId;\n        this.mapEntityCollection = entityCollection;\n\n        this.startInterval();\n\n        for (let index: number = 0; index < this.drone.drone.FlightController.Guided.Waypoints.length; index++) {\n            let wp: IGuidedWaypoint = this.drone.drone.FlightController.Guided.Waypoints[index];\n\n            this.getHAE(wp.lattitude, wp.longitude).then((height: number) => {\n                \n                let newWaypoint: MapWaypoint = new MapWaypoint(wp, index, height);\n\n                this.waypoints.splice(index, 0, newWaypoint);\n\n                this.addWaypointToMap(newWaypoint);\n\n                if (!this.currentWaypoint) {\n                    if (!newWaypoint.reached) {\n                        this.currentWaypoint = newWaypoint;\n                        this.currentIndex = index;\n                    }\n                }\n\n            });\n        }\n\n        this.calculateTimeAndDistance();\n\n        this.drone.drone.FlightController.Guided.on('waypoint-added', (wayPoint: IGuidedWaypoint, index: number) => {\n            console.log('waypoint-added: ' + index + ':' + wayPoint);\n\n            this.getHAE(wayPoint.lattitude, wayPoint.longitude).then((height: number) => {\n\n                this.waypoints.splice(index, 0, new MapWaypoint(wayPoint, index, height));\n\n                this.addWaypointToMap(this.waypoints[index]);\n\n                // Fix the animation clock\n                this.map.clock.currentTime = Cesium.JulianDate.now();\n\n                this.updateIndexes();\n\n            });\n        });\n\n        this.drone.drone.FlightController.Guided.on('waypoint-removed', (index: number) => {\n            console.log('waypoint-removed: ' + index);\n            this.removeWaypointFromMap(this.waypoints[index].name);\n            this.waypoints.splice(index, 1);\n            this.updateIndexes();\n        });\n        \n        this.drone.drone.FlightController.Guided.on('waypoints-changed', () => {\n            console.log('waypoints-changed');\n        });\n\n        this.drone.drone.FlightController.Guided.on('waypoint-error', (index: number, error: any) => {\n            console.log('waypoint-error: ' + index);\n            if (this.waypoints[index]) {\n                this.eventing.trigger('waypoint-error', this.waypoints[index].name);\n            }\n        });\n\n        this.drone.drone.FlightController.Guided.on('waypoint-started', (index: number) => {\n            console.log('waypoint-started: ' + index);\n            if (this.currentWaypoint) {\n                this.currentWaypoint.isActive = false;\n            }\n\n            this.currentWaypoint = this.waypoints[index];\n            this.currentIndex = index;\n            this.waypoints[index].isActive = true;\n        });\n\n        this.drone.drone.FlightController.Guided.on('waypoint-reached', (index: number) => {\n            console.log('waypoint-reached: ' + index);\n            this.waypoints[index].reached = true;\n            this.waypoints[index].isActive = false;\n        });\n    }\n\n    removeWaypointFromMap(name: string): void {\n        this.mapEntityCollection.entities.removeById(this.sessionId + name);\n    }\n\n    updateIndexes(): void {\n        this.waypoints.forEach((wp: MapWaypoint, index: number) => {\n            wp.index = index;\n        });\n    }\n\n    addWaypointToMap(waypoint: MapWaypoint): void {\n\n        if (!waypoint) {\n            return;\n        }\n\n        // create the svg image string\n        let svgDataDeclare: string = 'data:image/svg+xml,';\n        //var svgCircle: string = '<path style=\"fill:#ffffff\" d=\"M12,23.9L0.1,12L12,0.1L23.9,12L12,23.9z M4.4,12l7.6,7.6l7.6-7.6L12,4.4L4.4,12z\"/>';\n        let svgCircle: string =\n        `<defs>\n            <rect id=\"path-1\" x=\"6\" y=\"6\" width=\"25\" height=\"25\"></rect>\n        </defs>\n        <g id=\"Flight-Plan\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <g id=\"Rectangle-474\" transform=\"translate(18.500000, 18.500000) rotate(-315.000000) translate(-18.500000, -18.500000) \">\n                <use stroke=\"#FFFFFF\" stroke-width=\"2\" fill-opacity=\"0.5\" fill=\"` + this.color + `\" fill-rule=\"evenodd\" xlink:href=\"#path-1\"></use>\n            </g>\n            <text id=\"2\" font-family=\"OpenSans\" font-size=\"15\" font-weight=\"500\" fill=\"#FFFFFF\">\n                <tspan text-anchor=\"middle\" x=\"18.5\" y=\"24\">` + waypoint.name + `</tspan>\n            </text>\n        </g>`;\n        let svgPrefix: string = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 43 43\" xml:space=\"preserve\">';\n        let svgSuffix: string = '</svg>';\n        let svgString: string = svgPrefix + svgCircle + svgSuffix;\n\n        // let newWaypoint: string =\n        // `<svg width=\"35\" height=\"35\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\">\n        //     <g>\n        //         <title>Layer 1</title>\n        //         <g id=\"diamond\">\n        //             <rect id=\"svg_1\" height=\"25\" width=\"25\" fill-opacity=\"0.5\" fill=\"#0A92EA\" transform=\"matrix(0.7071,-0.7071,0.7071,0.7071,-8.4939,20.5061) \" y=\"4.006014\" x=\"8.006292\"/>\n        //             <rect id=\"svg_2\" height=\"25\" width=\"25\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"#FFFFFF\" fill=\"none\" transform=\"matrix(0.7071,-0.7071,0.7071,0.7071,-8.4939,20.5061) \" y=\"4.006012\" x=\"8.006292\"/>\n        //         </g>\n        //         <g stroke=\"null\" id=\"number\">\n        //             <text stroke-width=\"0\" stroke=\"null\" font-weight=\"normal\" font-style=\"normal\" x=\"50%\" y=\"50%\" id=\"svg_3\" font-size=\"15px\" font-family=\"&#x27;OpenSans-Semibold'\" fill=\"#FFFFFF\" transform=\"matrix(1,0,0,0.9583181738853455,13.0693,25.413596181405495) \">` + waypoint.name + `</text>\n        //         </g>\n        //     </g>\n        // </svg>`;\n\n        // create the cesium entity\n        let svgEntityImage: any = svgDataDeclare + svgString;\n\n        waypoint.entity = this.mapEntityCollection.entities.add({\n            name: waypoint.name,\n            id: this.sessionId + waypoint.name,\n            polyline: {\n                // positions: new Cesium.CallbackProperty( (): any => {\n                //     return Cesium.Cartesian3.fromDegreesArrayHeights(\n                //         [waypoint.longitude, waypoint.latitude, waypoint.hae,\n                //             waypoint.longitude, waypoint.latitude, waypoint.altitudeAGL + this.drone.homeHAE]);\n                // }, false) ,\n                positions: Cesium.Cartesian3.fromDegreesArrayHeights(\n                        [waypoint.longitude, waypoint.latitude, waypoint.hae,\n                            waypoint.longitude, waypoint.latitude, waypoint.altitudeAGL + this.drone.homeHAE]),\n                width: 2,\n                followSurface: false,\n                material: Cesium.Color.WHITE\n            },\n            // position: new Cesium.CallbackProperty( (): any => {\n            //     return Cesium.Cartesian3.fromDegrees(waypoint.longitude, waypoint.latitude, waypoint.altitudeAGL + this.drone.homeHAE);\n            // }, false),\n            position: Cesium.Cartesian3.fromDegrees(waypoint.longitude, waypoint.latitude, waypoint.altitudeAGL + this.drone.homeHAE),\n            billboard: {\n                    image: svgEntityImage,\n                    sizeInMeters : false,\n                    width : 43,\n                    height : 43,\n                    pixelOffset: new Cesium.Cartesian2(3, 7),\n                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM,\n            }\n            // point: {\n            //     pixelSize: 10,\n            //     color: Cesium.Color.fromBytes(255, 255, 255, 0),\n            //     outlineColor: Cesium.Color.fromBytes(255, 255, 255, 255),\n            //     outlineWidth: 2\n            // }\n        });\n\n        // Add bottom triangle to waypoint line\n        //  TODO - Track this entity so it can be removed later\n        // this.mapEntityCollection.add({\n        //     position: Cesium.Cartesian3.fromDegrees(waypoint.longitude, waypoint.latitude, 50),\n        //     billboard: {\n        //             image: svgEntityImage,\n        //             sizeInMeters : false,\n        //             width : 5,\n        //             height : 5,\n        //             pixelOffset: new Cesium.Cartesian2(3,7),\n        //             verticalOrigin : Cesium.VerticalOrigin.BOTTOM,\n        //             heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND\n        //     }\n        // });\n\n        // Wire up handler to listen for left click\n        // this.editingHandler.setInputAction( (click: any): void => {\n\n        //     // Check to see what the mouse has selected\n        //     var pickedObject: any = this.map.scene.pick(click.position);\n\n        //     // Check to make sure we are only grabbing the entity we are editing\n        //     if (Cesium.defined(pickedObject) && pickedObject.id === this.entity) {\n        //         console.log(pickedObject.id);\n        //         this.ShowMenu();\n        //     }\n        // }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\n    }\n\n    terrainProvider: any = new Cesium.CesiumTerrainProvider({\n        url : 'https://www.cesiumcontent.com/api/terrain/world?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJkMTM4ZDE2OS05NWYwLTQ0YmItOWY3YS0yNjEwOGE5Y2Y3NjYiLCJpZCI6NywiaWF0IjoxNDU1MjkyNzg5fQ.NDKlrwQZE_04ntDuL89hvatEmuycQo5llhtz3Mi6Wo0'\n        //url: '//assets.agi.com/stk-terrain/world'\n    });\n\n    getHAE(latitude: number, longitude: number): Promise<number> {\n                \n        return new Promise<number>((resolve) => {\n\n            var positions: Array<Cesium.Cartographic> = [\n                Cesium.Cartographic.fromDegrees(longitude, latitude)\n            ];\n\n            try {\n\n                // Get terrain height at click location before adding takeoff point\n                Cesium.sampleTerrain(this.terrainProvider, 15, positions).then((updatedPositions: any): void => {\n                    \n                    resolve(updatedPositions[0].height);\n\n                });\n            } catch (error) {\n                console.log(error);\n            }\n\n        });\n    }\n\n    // Variable for interval timer\n    intervalTimer: any;\n\n    startInterval(): void {\n\n        this.intervalTimer = setInterval(() => {\n\n            if (this.waypoints.length > 0 && this.currentWaypoint) {\n                this.calculateTimeAndDistance();\n            }\n\n        }, 500);\n    }\n\n    // TODO: Refactor into loop\n    calculateTimeAndDistance(): void {\n\n        if (this.waypoints.length === 0) {\n            return;\n        }\n\n        let currentTotal: number = 0;\n\n        // first calculate distance from drone to next waypoint and set as distance for that waypoint\n        currentTotal = this.currentWaypoint.distance = +(Conversions.distance2(this.drone.currentLat, this.drone.currentLng, this.currentWaypoint.latitude, this.currentWaypoint.longitude).toFixed());\n        this.currentWaypoint.time = (this.currentWaypoint.distance / this.drone.drone.FlightController.Telemetry.Position.groundSpeed) * 1000;\n        // second do same for the next 5 waypoints adding the previous total\n\n        if (this.waypoints[this.currentIndex + 1]) {\n\n            currentTotal += +(Conversions.distance2(this.currentWaypoint.latitude, this.currentWaypoint.longitude, this.waypoints[this.currentIndex + 1].latitude, this.waypoints[this.currentIndex + 1].longitude).toFixed(2));\n            this.waypoints[this.currentIndex + 1].distance = +currentTotal.toFixed();\n            this.waypoints[this.currentIndex + 1].time = (currentTotal / this.drone.drone.FlightController.Telemetry.Position.groundSpeed) * 1000;\n        }\n\n        if (this.waypoints[this.currentIndex + 2]) {\n\n            currentTotal += +(Conversions.distance2(this.waypoints[this.currentIndex + 1].latitude, this.waypoints[this.currentIndex + 1].longitude, this.waypoints[this.currentIndex + 2].latitude, this.waypoints[this.currentIndex + 2].longitude).toFixed(2));\n            this.waypoints[this.currentIndex + 2].distance = +currentTotal.toFixed();\n            this.waypoints[this.currentIndex + 2].time = (currentTotal / this.drone.drone.FlightController.Telemetry.Position.groundSpeed) * 1000;\n        }\n\n        if (this.waypoints[this.currentIndex + 3]) {\n\n            currentTotal += +(Conversions.distance2(this.waypoints[this.currentIndex + 2].latitude, this.waypoints[this.currentIndex + 2].longitude, this.waypoints[this.currentIndex + 3].latitude, this.waypoints[this.currentIndex + 3].longitude).toFixed(2));\n            this.waypoints[this.currentIndex + 3].distance = +currentTotal.toFixed();\n            this.waypoints[this.currentIndex + 3].time = (currentTotal / this.drone.drone.FlightController.Telemetry.Position.groundSpeed) * 1000;\n        }\n\n        if (this.waypoints[this.currentIndex + 4]) {\n\n            currentTotal += +(Conversions.distance2(this.waypoints[this.currentIndex + 3].latitude, this.waypoints[this.currentIndex + 3].longitude, this.waypoints[this.currentIndex + 4].latitude, this.waypoints[this.currentIndex + 4].longitude).toFixed(2));\n            this.waypoints[this.currentIndex + 4].distance = +currentTotal.toFixed();\n            this.waypoints[this.currentIndex + 4].time = (currentTotal / this.drone.drone.FlightController.Telemetry.Position.groundSpeed) * 1000;\n        }\n    }\n}\n\nexport class MapSession {\n\n    // Map reference\n    map: Cesium.Viewer;\n\n    // Server session object\n    session: ISession;\n\n    // The current drone on the map\n    mapDrone: MapDrone;\n\n    // Server connection\n    serverConnection: ServerConnection;\n\n    // The selected mode of the map\n    mapMode: MapMode = MapMode.ThreeDimensional;\n\n    // Name of current session\n    name: string;\n\n    mapWaypoints: MapWaypoints;\n\n    // Color to render map UI\n    color: string;\n\n    eventing: FlightControlViewerEventing;\n\n    id: string;\n\n    // Container for all map UI related to this session\n    mapEntityCollection: Cesium.CustomDataSource;\n\n    constructor() {\n        this.mapEntityCollection = new Cesium.CustomDataSource;\n    }\n\n    initializeSession(eventing: FlightControlViewerEventing, session: ISession, serverConnection: ServerConnection, map: Cesium.Viewer, mapMode: MapMode): Promise<MapSession> {\n\n        return new Promise<MapSession>((resolve) => {\n\n            this.map = map;\n            this.session = session;\n            this.serverConnection = serverConnection;\n            this.mapMode =  mapMode;\n            this.name = this.session.Name;\n            this.eventing = eventing;\n            this.color = this.session.Color;\n            this.id = this.session.Id;\n            \n            // WARNING BAD CODE (Robert made me do this!) - drone index 0 is hardcoded here\n            this.session.getDrones().then((drones: Array<IDrone>) => {\n            \n                this.mapDrone = new MapDrone(this.mapEntityCollection);\n\n                // Suspend entity events while adding all waypoints to map\n                this.mapEntityCollection.entities.suspendEvents();\n\n                this.mapDrone.initializeDrone(this.eventing, drones[0], this.map, this.color, false).then((mapDrone: MapDrone) => {\n                    this.mapDrone = mapDrone;\n\n                    // Initialize waypoints for guided mode\n                    this.mapWaypoints = new MapWaypoints(this.mapDrone, this.map, this.color, this.id, this.mapEntityCollection, this.eventing);\n\n                    // Resume entity events after added\n                    this.mapEntityCollection.entities.resumeEvents();\n\n                    resolve(this);\n                });                \n            });\n\n        });\n\n    }\n\n    remove(): void {\n        // This will remove everyting in the collection associated with this session\n        this.mapEntityCollection.entities.removeAll();\n    }\n\n    drawFlightPath(): void {\n        try {\n            this.mapEntityCollection.entities.add({\n                name: 'Flight Path',\n                polyline: {\n                    // TODO - move to static property and manually trigger the redraw for trigger changes.\n                    positions: new Cesium.CallbackProperty( (): any => {\n\n                        //console.log('command viewer property callback');\n\n                        var degreesArray: Array<Cesium.Cartesian3> = [];\n\n                        // this.commands.forEach((command: Command): void => {\n                        //     degreesArray.push(Cesium.Cartesian3.fromDegrees((<WaypointCommand>command).Position.lng, (<WaypointCommand>command).Position.lat, (<WaypointCommand>command).AltitudeHAE));\n                        // });\n\n                        return degreesArray;\n\n                    }, false),\n                    width: 2,\n                    material: Cesium.Color.fromCssColorString(this.color)\n                }//,\n                // wall: {\n                //     positions: new Cesium.CallbackProperty( (): any => {\n\n                //         var degreesArray: Array<Cesium.Cartesian3> = [];\n\n                //         this.commands.forEach((command: Command): void => {\n                //             degreesArray.push(Cesium.Cartesian3.fromDegrees((<WaypointCommand>command).Position.lng, (<WaypointCommand>command).Position.lat, (<WaypointCommand>command).AltitudeHAE));\n                //         });\n\n                //         return degreesArray;\n\n                //     }, false) ,\n                //     material: Cesium.Color.fromBytes(10, 146, 234, 100)\n                // }\n            });\n\n        } catch (exception) {\n            console.log(exception);\n        }\n    }\n}\n\nBackboneEvents.mixin(MapSession.prototype);\n\n// Represents\nexport class OwnerMapSession extends MapSession implements IMapSessionEvents {\n\n    // Backbone events    \n    on: (eventName: string, callback?: Function, context?: any) => any;\n    once: (events: string, callback: Function, context?: any) => any;\n    off: (eventName?: string, callback?: Function, context?: any) => any;\n    protected trigger: (eventName: string, ...args: any[]) => any;\n\n    // Flag to indicate whether the user created the session allowing all guests without\n    // prompting for permission\n    allowAllGuestsWithoutPrompt: boolean = false;\n\n    // List of guests that are connected\n    connectedGuests: Array<string> = [];\n\n    constructor() {\n        super();\n    }\n\n    initializeOwnerSession(eventing: FlightControlViewerEventing, session: ISession, serverConnection: ServerConnection, map: Cesium.Viewer, mapMode: MapMode, allowAllGuestsWithoutPrompt: boolean): Promise<OwnerMapSession> {\n\n        return new Promise<OwnerMapSession>((resolve) => {\n\n            this.map = map;\n            this.session = session;\n            this.serverConnection = serverConnection;\n            this.mapMode =  mapMode;\n            this.name = this.session.Name;\n            this.eventing = eventing;\n            this.allowAllGuestsWithoutPrompt = allowAllGuestsWithoutPrompt;\n            this.color = this.session.Color;\n            this.id = this.session.Id;\n            \n            // WARNING BAD CODE (Robert made me do this!) - drone index 0 is hardcoded here\n            this.session.getDrones().then((drones: Array<IDrone>) => {\n            \n                this.mapDrone = new MapDrone(this.mapEntityCollection);\n\n                this.mapDrone.initializeDrone(this.eventing, drones[0], this.map, this.color, true).then((mapDrone: MapDrone) => {\n                    this.mapDrone = mapDrone;\n\n                    this.setupEvents();\n\n                    // Initialize waypoints for guided mode\n                    this.mapWaypoints = new MapWaypoints(this.mapDrone, this.map, this.color, this.id, this.mapEntityCollection, this.eventing);\n\n                    resolve(this);\n                });                \n            });\n\n        });\n\n    }\n\n    setupEvents(): void {\n\n        this.session.on('slave-connected', (username: string) => {\n            \n            // Add username\n            this.connectedGuests.push(username);\n\n        });\n\n        this.session.on('slave-disconnected', (username: string) => {\n\n            // Remove username\n            _.remove<string>(this.connectedGuests, (name: string) => {\n                return username.toLowerCase() === name.toLowerCase() ? true : false;\n            });\n\n        });\n\n        // Wire up slave connection request\n        this.session.on('slave-requesting-connection', (username: string, cb: (accepted: boolean) => { }) => {\n            \n            // check allow all guests flag and return true and exit\n            if (this.allowAllGuestsWithoutPrompt) {\n                cb(true);\n                return;\n            }\n\n            this.eventing.trigger('guest-connect-request', username, cb);\n            \n        });\n\n    }\n\n    remove(): void {\n        // First call remove on the drone\n        this.mapDrone.remove();\n\n        this.session.off('slave-connected');\n\n        this.session.off('slave-disconnected');\n\n        this.session.off('slave-requesting-connection');\n    }\n}\n"],"sourceRoot":"/source/"}