{"version":3,"sources":["components/tools/waypointTool/waypointCommandInstance.ts"],"names":[],"mappings":"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","file":"components/tools/waypointTool/waypointCommandInstance.js","sourcesContent":["import { Conversions } from '@dronesense/model/lib/common/Utility';\nimport { User, WaypointCommand, Camera, GeoPoint } from '@dronesense/model';\n\nimport commandHeader from '../../../components/commandHeader/commandHeader';\nimport formatter from '../../../components/formatters/infoFormatter';\nimport readableElevation from '../../../common/readableElevation';\nimport unitString from '../../../components/formatters/unitString';\n\nimport MapService from '../../../services/mapService';\nimport { IMapService } from '../../../services/mapService';\n\nexport interface IWaypointCommandInstance extends ng.IScope {\n    command: WaypointCommand;\n    user: User;\n    trackedEntity: string;\n    onTrackEntity: any;\n}\n\nexport class WaypointCommandInstance {\n\n    // The waypoint command passed in\n    command: WaypointCommand;\n\n    // Map instance passed in\n    map: Cesium.Viewer;\n\n    // User object allows us to modify presentation of data based on user settings\n    user: User;\n\n    // On delete callback\n    onDelete: any;\n\n    // Currently tracked entity passed in from command viewer\n    trackedEntity: string;\n\n    // Called to notify command viewer of a request for tracking\n    onTrackEntity: any;\n\n    // Camera object for sensor visualization\n    camera: Camera;\n\n    // Visual representation of command\n    entity: Cesium.Entity;\n\n    // Flag to indicate if command is being edited in map\n    isEditing: boolean = false;\n\n    // Editing handler reference\n    editingHandler: Cesium.ScreenSpaceEventHandler;\n\n    isAGLAltitudeMode: boolean;\n\n    flightSpeed: number;\n\n    position: GeoPoint;\n\n    altitude: number;\n\n    altitudeMSL: number;\n\n    // Handle on blur property change\n    UpdateAltitude(positionChanged: boolean): void {\n\n        var groundElevationMSL: number;\n        var groundElevationHAE: number;\n\n        // If position changed we need to query the elevation service\n        if (positionChanged) {\n\n            // Make call to get elevation\n            this.mapService.getElevation(this.position.lat, this.position.lng).then((terrainElevation: number): void => {\n\n                groundElevationMSL = terrainElevation;\n                groundElevationHAE = terrainElevation;\n\n                this.UpdateDBAltitudes(groundElevationMSL, groundElevationHAE);\n\n            });\n        // no need to use elevation service if the position hasn't changed just use existing values\n        } else {\n\n            groundElevationMSL = this.command.GroundElevationMSL;\n            groundElevationHAE = this.command.GroundElevationHAE;\n\n            this.UpdateDBAltitudes(groundElevationMSL, groundElevationHAE);\n        }\n    }\n\n    UpdateDBAltitudes(groundElevationMSL: number, groundElevationHAE: number): void {\n        // If we are in AGL mode then altitudeMSL must be calculated\n        if (this.isAGLAltitudeMode) {\n            this.command.UpdateProperties({\n                Altitude: this.altitude,\n                GroundElevationMSL: groundElevationMSL,\n                GroundElevationHAE: groundElevationHAE,\n                AltitudeMSL: groundElevationMSL + this.altitude,\n                AltitudeHAE: groundElevationHAE + this.altitude\n            });\n        } else {\n            this.command.UpdateProperties({\n                Altitude: this.altitudeMSL - this.command.GroundElevationMSL,\n                GroundElevationMSL: groundElevationMSL,\n                GroundElevationHAE: groundElevationHAE,\n                AltitudeMSL: this.altitudeMSL,\n                AltitudeHAE: this.altitudeMSL\n            });\n        }\n    }\n\n    UpdatePosition(): void {\n\n        // Save property on model\n        this.command.SaveProperty(this.position, 'Position');\n\n        // Update new position altitude\n        this.UpdateAltitude(true);\n\n    }\n\n    // Remove self from map then call viewer for removal\n    Delete(): void {\n\n        // Remove UI from map\n        this.map.entities.remove(this.entity);\n\n        // Call parent delete function\n        this.onDelete({commandId: this.command.handle.id });\n    }\n\n    // Fly camera to this command\n    FlyTo(): void {\n        this.map.flyTo(this.entity);\n    }\n\n    // Toggle visibility on map\n    HideShow(): void {\n        this.entity.show = !this.entity.show;\n    }\n\n    // Constructor\n    static $inject: Array<string> = [\n        '$scope',\n        'db',\n        'mapService'\n    ];\n\n    constructor(public bindings: IWaypointCommandInstance,\n                public db: any,\n                public mapService: IMapService) {\n\n\n        this.SetupEditingHandlers();\n\n        // Create copy for UI binding\n        this.SetupViewData();\n\n        // Add UI to map\n        this.generateMapUI();\n\n        // Listen for model changes\n        this.command.on('propertyChanged', (name: string, value: any): void => {\n\n            this.bindings.$applyAsync();\n        });\n\n        this.bindings.$on('$destroy', (): void => {\n\n            // watchers are automatically destroyed\n\n            // destruction code here\n            this.user.off();\n\n            this.command.off();\n\n            // Clean up editing handler\n            this.editingHandler.destroy();\n        });\n\n        // Update camera track changes\n        this.bindings.$watch(() => { return this.trackedEntity; }, (newValue: string, oldValue: string): void => {\n\n            this.trackedFlag = (this.entity.id === newValue);\n\n        });\n\n        //this.isAGLAltitudeMode = !this.settings.PlanningAltitudeMSL;\n    }\n\n    // Bind two way fields that are also update\n    SetupViewData(): void {\n\n        this.flightSpeed = this.command.FlightSpeed;\n\n        this.bindings.$watch(() => { return this.command.FlightSpeed; }, (newValue: number, oldValue: number) => {\n            this.flightSpeed = this.command.FlightSpeed;\n        });\n\n        this.position = this.command.Position;\n\n        this.bindings.$watch(() => { return this.command.Position; }, (newValue: GeoPoint, oldValue: GeoPoint) => {\n            this.position = this.command.Position;\n        });\n\n        this.altitude = this.command.Altitude;\n\n        this.bindings.$watch(() => { return this.command.Altitude; }, (newValue: number, oldValue: number) => {\n            this.altitude = this.command.Altitude;\n        });\n\n        this.altitudeMSL = this.command.AltitudeMSL;\n\n        this.bindings.$watch(() => { return this.command.AltitudeMSL; }, (newValue: number, oldValue: number) => {\n            this.altitudeMSL = this.command.AltitudeMSL;\n        });\n    }\n\n    SetupEditingHandlers(): void {\n        this.editingHandler = new Cesium.ScreenSpaceEventHandler(this.map.canvas);\n    }\n\n    getWaypointSVG(index: number): string {\n        return '';\n    }\n\n    generateMapUI(): void {\n\n            // create the svg image string\n            var svgDataDeclare: string = 'data:image/svg+xml,';\n            //var svgCircle: string = '<path style=\"fill:#ffffff\" d=\"M12,23.9L0.1,12L12,0.1L23.9,12L12,23.9z M4.4,12l7.6,7.6l7.6-7.6L12,4.4L4.4,12z\"/>';\n            var svgCircle: string =\n            `<defs>\n                <rect id=\"path-1\" x=\"6\" y=\"6\" width=\"25\" height=\"25\"></rect>\n            </defs>\n            <g id=\"Flight-Plan\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n                <g id=\"Rectangle-474\" transform=\"translate(18.500000, 18.500000) rotate(-315.000000) translate(-18.500000, -18.500000) \">\n                <use stroke=\"#FFFFFF\" stroke-width=\"2\" fill-opacity=\"0.5\" fill=\"#0A92EA\" fill-rule=\"evenodd\" xlink:href=\"#path-1\"></use>\n                </g>\n                <text id=\"2\" font-family=\"OpenSans-Extrabold, Open Sans\" font-size=\"15\" font-weight=\"600\" fill=\"#FFFFFF\">\n                <tspan text-anchor=\"middle\" x=\"18.5\" y=\"24\">` + this.command.Order + `</tspan>\n                </text>\n            </g>`;\n            var svgPrefix: string = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 43 43\" xml:space=\"preserve\">';\n            var svgSuffix: string = '</svg>';\n            var svgString: string = svgPrefix + svgCircle + svgSuffix;\n\n            var newWaypoint: string =\n            `<svg width=\"35\" height=\"35\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\">\n                <g>\n                    <title>Layer 1</title>\n                    <g id=\"diamond\">\n                        <rect id=\"svg_1\" height=\"25\" width=\"25\" fill-opacity=\"0.5\" fill=\"#0A92EA\" transform=\"matrix(0.7071,-0.7071,0.7071,0.7071,-8.4939,20.5061) \" y=\"4.006014\" x=\"8.006292\"/>\n                        <rect id=\"svg_2\" height=\"25\" width=\"25\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"#FFFFFF\" fill=\"none\" transform=\"matrix(0.7071,-0.7071,0.7071,0.7071,-8.4939,20.5061) \" y=\"4.006012\" x=\"8.006292\"/>\n                    </g>\n                    <g stroke=\"null\" id=\"number\">\n                        <text stroke-width=\"0\" stroke=\"null\" font-weight=\"normal\" font-style=\"normal\" x=\"50%\" y=\"50%\" id=\"svg_3\" font-size=\"15px\" font-family=\"&#x27;OpenSans-Semibold'\" fill=\"#FFFFFF\" transform=\"matrix(1,0,0,0.9583181738853455,13.0693,25.413596181405495) \">` + this.command.Order + `</text>\n                    </g>\n                </g>\n            </svg>`;\n\n            // create the cesium entity\n            var svgEntityImage: any = svgDataDeclare + svgString;\n\n        //  var entity = viewer.entities.add({\n        //      position: Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883, 10),\n        //      billboard: {\n        //          image: svgEntityImage\n        //      }\n        //  });\n\n        this.entity = this.map.entities.add({\n            name: this.command.Name,\n            id: this.command.handle.id,\n            polyline: {\n                positions: new Cesium.CallbackProperty( (): any => {\n                    return Cesium.Cartesian3.fromDegreesArrayHeights(\n                        [this.position.lng, this.position.lat, this.command.GroundElevationHAE,\n                            this.position.lng, this.position.lat, this.altitude + this.command.GroundElevationHAE]);\n                }, false) ,\n                width: 2,\n                material: Cesium.Color.fromBytes(255, 255, 255, 255)\n            },\n            position: new Cesium.CallbackProperty( (): any => {\n                return Cesium.Cartesian3.fromDegrees(this.position.lng, this.position.lat, this.altitude + this.command.GroundElevationHAE);\n            }, false),\n            billboard: {\n                    image: svgEntityImage,\n                    sizeInMeters : false,\n                    width : 43,\n                    height : 43,\n                    pixelOffset: new Cesium.Cartesian2(3,7),\n                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM,\n            }\n            // point: {\n            //     pixelSize: 10,\n            //     color: Cesium.Color.fromBytes(255, 255, 255, 0),\n            //     outlineColor: Cesium.Color.fromBytes(255, 255, 255, 255),\n            //     outlineWidth: 2\n            // }\n        });\n\n        // Add bottom triangle to waypoint line\n        //  TODO - Track this entity so it can be removed later\n        this.map.entities.add({\n            position: new Cesium.CallbackProperty( (): any => {\n                return Cesium.Cartesian3.fromDegrees(this.position.lng, this.position.lat, this.command.GroundElevationHAE);\n            }, false),\n            billboard: {\n                    image: svgEntityImage,\n                    sizeInMeters : false,\n                    width : 5,\n                    height : 5,\n                    pixelOffset: new Cesium.Cartesian2(3,7),\n                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM,\n            }\n        });\n\n        // Wire up handler to listen for left click\n        this.editingHandler.setInputAction( (click: any): void => {\n\n            // Check to see what the mouse has selected\n            var pickedObject: any = this.map.scene.pick(click.position);\n\n            // Check to make sure we are only grabbing the entity we are editing\n            if (Cesium.defined(pickedObject) && pickedObject.id === this.entity) {\n                console.log(pickedObject.id);\n                this.ShowMenu();\n            }\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\n\n    }\n\n    ShowMenu(): void {\n\n            var svgMenuString: string =\n            `<svg version=\"1.1\" id=\"contextMenu\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\"\n                    y=\"0px\" viewBox=\"0 0 110.8 93.7\" enable-background=\"new 0 0 110.8 93.7\" xml:space=\"preserve\">\n                <style>\n                    .foo:hover {\n                        fill: #eee;\n                    }\n                </style>\n                <g id=\"map\" transform=\"translate(385.000000, 90.000000)\">\n                    <g id=\"waypoints\" transform=\"translate(7.000000, 59.000000)\">\n                        <g id=\"waypoint\" transform=\"translate(165.000000, 363.000000)\">\n                            <g id=\"context-menu\">\n                                <g id=\"Page-1\" opacity=\"0.9\">\n                                    <path class=\"foo\" id=\"Fill-1\" fill=\"#FFFFFF\" d=\"M-501.7-480c6,0,11.5,2.3,15.7,6l22.6-22.6c-9.9-9.5-23.4-15.4-38.3-15.4\n                                        s-28.3,5.9-38.3,15.4l22.6,22.6C-513.2-477.7-507.7-480-501.7-480\"/>\n                                    <path id=\"Fill-3\" fill=\"#FFFFFF\" d=\"M-461.6-494.9l-22.6,22.6c3.7,4.1,6,9.6,6,15.7c0,6-2.3,11.5-6,15.7l22.6,22.6\n                                        c9.5-9.9,15.4-23.4,15.4-38.3C-446.2-471.5-452.1-484.9-461.6-494.9\"/>\n                                    <path id=\"Fill-6\" fill=\"#FFFFFF\" d=\"M-519-472.3l-22.6-22.6c-9.5,9.9-15.4,23.4-15.4,38.3s5.9,28.3,15.4,38.3L-519-441\n                                        c-3.7-4.1-6-9.6-6-15.7S-522.7-468.2-519-472.3z\"/>\n                                </g>\n                            </g>\n                        </g>\n                    </g>\n                </g>\n                <g>\n                    <path fill=\"#0A92EA\" d=\"M16.5,53.4c-0.3,0-0.6,0.1-0.8,0.2c-0.5,0.2-0.9,0.6-1.1,1.1c-0.2,0.5-0.2,1.1,0,1.6\n                        c0.3,0.8,1.1,1.3,1.9,1.3c0.3,0,0.6-0.1,0.8-0.2c0.5-0.2,0.9-0.6,1.1-1.1c0.2-0.5,0.2-1.1,0-1.6C18.1,53.9,17.3,53.4,16.5,53.4z\"/>\n                    <path fill=\"#0A92EA\" d=\"M23.9,57l-1-1c0-0.1,0-0.1,0-0.2c0-0.3,0-0.6,0-1l1-1.1c0.1-0.1,0.1-0.2,0.1-0.3c-0.1-0.4-0.2-0.8-0.4-1.2\n                        c-0.1-0.3-0.3-0.5-0.4-0.8c-0.1-0.1-0.2-0.1-0.3-0.1l-1.4,0c-0.3-0.4-0.6-0.7-1-1l0-1.5c0-0.1-0.1-0.2-0.1-0.3\n                        c-0.6-0.3-1.2-0.6-1.9-0.8c-0.1,0-0.2,0-0.3,0.1l-1,1c-0.1,0-0.1,0-0.2,0c-0.4,0-0.8,0-1.2,0l-1.1-1c-0.1-0.1-0.2-0.1-0.3-0.1\n                        c-0.3,0.1-0.7,0.2-1,0.3c-0.3,0.1-0.6,0.3-0.9,0.5c-0.1,0.1-0.1,0.2-0.1,0.3l0,1.5c-0.3,0.3-0.6,0.6-0.9,1l-1.5,0\n                        c-0.1,0-0.2,0.1-0.3,0.2c-0.3,0.6-0.6,1.3-0.7,1.9c0,0.1,0,0.2,0.1,0.3l1.2,1.1c0,0.4,0,0.8,0,1.1l-1.1,1.1\n                        c-0.1,0.1-0.1,0.2-0.1,0.3c0.1,0.3,0.2,0.6,0.3,0.9c0.2,0.4,0.4,0.7,0.6,1.1c0.1,0.1,0.1,0.1,0.3,0.1l1.6,0\n                        c0.2,0.2,0.4,0.5,0.7,0.7l0,1.6c0,0.1,0.1,0.2,0.2,0.3c0.7,0.4,1.4,0.6,2.1,0.8c0,0,0,0,0.1,0c0.1,0,0.2,0,0.2-0.1l1.1-1.2\n                        c0.3,0,0.6,0,0.9,0l1.1,1.1c0.1,0.1,0.2,0.1,0.3,0.1c0.4-0.1,0.7-0.2,1.1-0.4c0.3-0.1,0.7-0.3,1-0.5c0.1-0.1,0.1-0.2,0.1-0.3l0-1.5\n                        c0.2-0.2,0.5-0.4,0.7-0.7l1.5,0c0.1,0,0.2-0.1,0.3-0.1c0.4-0.6,0.7-1.3,0.8-2.1C24,57.2,24,57.1,23.9,57z M20.7,57.1\n                        c-0.4,1.1-1.3,2-2.4,2.5c-0.6,0.2-1.2,0.4-1.8,0.4c-1.8,0-3.5-1.1-4.2-2.7c-0.5-1.1-0.5-2.4-0.1-3.5c0.4-1.1,1.3-2,2.4-2.5\n                        c0.6-0.3,1.2-0.4,1.8-0.4c1.8,0,3.5,1.1,4.2,2.7C21.2,54.8,21.2,56,20.7,57.1z\"/>\n                </g>\n                <g>\n                    <ellipse fill=\"#0A92EA\" cx=\"55\" cy=\"18.4\" rx=\"2.2\" ry=\"2.2\"/>\n                    <path fill=\"#0A92EA\" d=\"M57.8,13.4v-2.1H52v2.1h-4.9v10.1h15.7V13.4H57.8z M55,22.3c-2.1,0-3.8-1.7-3.8-3.8s1.7-3.8,3.8-3.8\n                        c2.1,0,3.8,1.7,3.8,3.8S57.1,22.3,55,22.3z\"/>\n                </g>\n                <polygon fill=\"#0A92EA\" points=\"95.7,49 95.7,48 92.4,48 92.4,49 88.1,49 88.1,50.3 100.1,50.3 100.1,49 \"/>\n                <path fill=\"#0A92EA\" d=\"M89.2,63h9.7V51.3h-9.7V63z M95.9,53h1v8.3h-1V53z M93.6,53h1v8.3h-1V53z M91.2,53h1v8.3h-1V53z\"/>\n            </svg>`;\n\n            // HTMLDivElement\n            var menuContainer: any = document.createElement('div');\n            menuContainer.innerHTML = svgMenuString;\n\n            this.map.container.appendChild(menuContainer);\n            menuContainer.style.display = 'none';\n            menuContainer.style.position = 'absolute';\n            menuContainer.style.top = '0';\n            menuContainer.style.left = '0';\n            menuContainer.style.width = '120px';\n            menuContainer.style.height = '93px';\n            menuContainer.style['pointer-events'] = 'none'; //Disable mouse interaction\n\n            //The geolocation that we want to the element t olive.\n            var anchor: Cesium.Cartesian3 = Cesium.Cartesian3.fromDegrees(this.position.lng, this.position.lat, this.altitude + this.command.GroundElevationHAE);\n\n            //Every frame, figure out if the geolocation is on the screen\n            //and move the element accordingly.\n            var tmp: Cesium.Cartesian2 = new Cesium.Cartesian2();\n            this.map.scene.preRender.addEventListener(() => {\n                var result = Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.map.scene, anchor, tmp);\n                if(Cesium.defined(result)) {\n                    menuContainer.style.display = 'block';\n                    menuContainer.style.top = tmp.y + 12 + 'px';\n                    menuContainer.style.left = tmp.x + 5 + 'px';\n                } else {\n                    menuContainer.style.display = 'none';\n                }\n            });\n    }\n\n    Edit(): void {\n        if (this.isEditing) {\n            this.isEditing = false;\n            // Turn off editing and make appropriate updates\n\n            this.editingHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN);\n            this.editingHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP);\n            this.editingHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n\n        } else {\n            // Turn on editing and wire up event listening\n\n            this.isEditing = true;\n            var dragging: any;\n\n            // Wire up handler to listen for left mouse down event\n            this.editingHandler.setInputAction( (click: any): void => {\n\n                // Check to see what the mouse has selected\n                var pickedObject: any = this.map.scene.pick(click.position);\n\n                // Check to make sure we are only grabbing the entity we are editing\n                if (Cesium.defined(pickedObject) && pickedObject.id === this.entity) {\n                    dragging = pickedObject;\n\n                    // Turn off rotation so we only move the entity\n                    this.map.scene.screenSpaceCameraController.enableRotate = false;\n\n                    // Turn off depth testing so we can see the feature around terrain\n                    this.map.scene.globe.depthTestAgainstTerrain = false;\n                }\n            }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\n\n            // Wire up handler to listen for left mouse up event\n            this.editingHandler.setInputAction( (): void => {\n\n                // Check if dragging entity is defined\n                if (Cesium.defined(dragging)) {\n\n                    // Reset to undefined\n                    dragging = undefined;\n\n                    // Renable rotation\n                    this.map.scene.screenSpaceCameraController.enableRotate = true;\n\n                    // Turn depth testing back on\n                    this.map.scene.globe.depthTestAgainstTerrain = true;\n\n                    this.UpdatePosition();\n                }\n            }, Cesium.ScreenSpaceEventType.LEFT_UP);\n\n            // Wire up handler for each mouse move while entity is being dragged\n            this.editingHandler.setInputAction( (movement: any): void => {\n\n                // Return immediately if we are not dragging anything\n                if (!dragging) {\n                    return;\n                }\n\n                // Use ray pick to get position and convert\n                var ray: any = this.map.camera.getPickRay(movement.endPosition);\n                var position: any = this.map.scene.globe.pick(ray, this.map.scene);\n\n                // Check to see if the position is defined\n                if (!Cesium.defined(position) || !dragging) {\n                    return;\n                }\n\n                var positionCartographic: any = this.map.scene.globe.ellipsoid.cartesianToCartographic(position);\n                positionCartographic.height = 0;\n                //position = this.map.scene.globe.ellipsoid.cartographicToCartesian(positionCartographic);\n\n                //var cartographic: Cesium.Cartographic = Cesium.Cartographic.fromCartesian(position);\n                var longitude: number = Conversions.formatCoordinate(Cesium.Math.toDegrees(positionCartographic.longitude), 8);\n                var latitude: number = Conversions.formatCoordinate(Cesium.Math.toDegrees(positionCartographic.latitude), 8);\n\n                this.position.lng = longitude;\n                this.position.lat = latitude;\n\n                this.bindings.$applyAsync();\n\n            }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n        }\n    }\n\n    trackedFlag: boolean = false;\n\n    TrackEntity(): void {\n        this.onTrackEntity({id: this.entity.id });\n    }\n\n}\n\n// Register component with Angular\nexport default angular.module('DroneSense.Web.Tools.WaypointCommandInstance', [\n    commandHeader.name,\n    formatter.name,\n    readableElevation.name,\n    unitString.name,\n    MapService.name\n]).component('dsWaypointCommandInstance', {\n    transclude: true,\n    bindings: {\n        command: '<',\n        onCommandChange: '&',\n        map: '<',\n        user: '<',\n        onDelete: '&',\n        trackedEntity: '<',\n        onTrackEntity: '&',\n        camera: '<',\n        settings: '<'\n    },\n    controller: WaypointCommandInstance,\n    templateUrl: './app/components/tools/waypointTool/waypointCommandInstance.html'\n});\n\n"],"sourceRoot":"/source/"}